---
title: "Data Analysis and Initial Results"
author: "Fabian Aiolfi"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    latex_engine: xelatex
    extra_dependencies: "microtype"
mainfont: Times New Roman
bibliography: references.bib
csl: american-journal-of-political-science.csl
classoption: a4paper
lang: en-UK
header-includes:
   - \usepackage{hyperref}
   - \usepackage{setspace}
   - \onehalfspacing
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## Setup
library(tidyverse)
library(here)
library(sf)
library(shiny)
library(lubridate)
library(haven)
library(here)
library(strucchange) # Chow test in MA_Thesis/scripts/preliminary_exploration/02_fom_emigration/04_models.R
library(readxl) # Read in .xls files
library(scales) # This will ensure that numbers on the y-axis are formatted with commas and without scientific notation.
library(plm) # Panel data analysis
library(stargazer) # Exporting nice tables
library(eurostat) # NUTS3 names
library(slider) # Rolling averages

library(knitr)
library(kableExtra)
library(memisc)
library(pandoc)
library(pander)
library(scales)
library(fixest)
library(modelsummary)

options(scipen = 0) # Enable scientific notation
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
load(here("data", "01_anti_incumbent_vote", "ned_v_dem_cee.Rda"))
load(here("data", "02_external_emigration", "nuts3_population.Rda"))
load(here("data", "02_external_emigration", "bg", "bg.Rda"))
load(here("data", "02_external_emigration", "hr", "hr.Rda"))
load(here("data", "02_external_emigration", "ee", "ee.Rda"))
load(here("data", "02_external_emigration", "hu", "hu.Rda"))
load(here("data", "02_external_emigration", "lv", "lv.Rda"))
load(here("data", "02_external_emigration", "lt", "lt.Rda"))
load(here("data", "02_external_emigration", "pl", "pl.Rda"))
load(here("data", "02_external_emigration", "ro", "ro.Rda"))
load(here("data", "02_external_emigration", "sk", "sk.Rda"))
load(here("data", "02_external_emigration", "si", "si.Rda"))
cee_crude_emigration <- bind_rows(bg, ee, hr, hu, lt, lv, pl, ro, si, sk)
cee_crude_emigration <- cee_crude_emigration %>% mutate(country = substr(NUTS_ID, 1, 2))

load(here("data", "01_anti_incumbent_vote", "ned_v_dem_cee.Rda"))
load(here("data", "02_external_emigration", "cee_crude_emigration.Rda"))

load(here("data", "03_service_cuts", "pl", "pl_schools.Rda"))
load(here("data", "03_service_cuts", "pl", "pl_hospitals.Rda"))
load(here("data", "03_service_cuts", "pl", "pl_third_places.Rda"))
load(here("data", "03_service_cuts", "pl", "pl_remittances.Rda"))
load(here("data", "03_service_cuts", "pl", "pl_gdp.Rda"))

load(here("data", "02_external_emigration", "ro", "ro_population.Rda"))
load(here("data", "03_service_cuts", "ro", "ro_schools.Rda"))
load(here("data", "03_service_cuts", "ro", "ro_hospitals.Rda"))
load(here("data", "03_service_cuts", "ro", "ro_third_places.Rda"))
load(here("data", "03_service_cuts", "ro", "ro_remittances.Rda"))
load(here("data", "03_service_cuts", "ro", "ro_gdp.Rda"))

# Plot Compontents
pl_plots_components <- list(
  scale_color_gradient(low = "blue", high = "red", guide = guide_colourbar(direction = "horizontal", barheight = 0.5, title.position = "top")),
  facet_wrap(~ NUTS_ID, scales = "free_y", ncol = 4),
  # scale_y_continuous(labels = function(x) format(x, nsmall = 0)),
  scale_y_continuous(breaks = function(x) pretty(x, n = 3), labels = label_comma()), # Adjust y-axis breaks
  scale_x_continuous(breaks = c(1995, 2020)),
  ylab(""), xlab(""), theme_minimal(),
  theme(legend.position = c(0.5, 0.04), 
        legend.title = element_text(size = 8),
        axis.text = element_text(size = 8),
        axis.title = element_text(size = 8))
)

ro_plots_components <- list(
  scale_color_gradient(low = "blue", high = "red", guide = guide_colourbar(direction = "horizontal", barheight = 0.5, title.position = "top")),
  facet_wrap(~ NUTS_ID, scales = "free_y", ncol = 4),
  scale_y_continuous(breaks = function(x) pretty(x, n = 3), labels = label_comma()),  # Adjust y-axis breaks
  scale_x_continuous(breaks = c(2000, 2020)),  # Adjust x-axis for dates
  ylab(""), xlab(""), theme_minimal(),
  theme(legend.position = c(0.7, 0.02),
        legend.title = element_text(size = 8),
        axis.text = element_text(size = 8),
        axis.title = element_text(size = 8))
)
```

## Introduction
This document shows an overview of my data analysis and provides initial results. It starts with an overview of all eleven CEE EU member states. Descriptive statistics display insights into the available data. I then continue by modelling emigration on incumbent vote change using a fixed effects model. Results show that an increase in emigration is associated with a decrease in incumbent vote share.

In a second step I focus on the effects of service cuts in Poland. I again begin with descriptive statistics that provide an overview. Then I model the effects of service cuts on incumbent vote change. Results partially align with what my theory predicts. An increase in the number of children per school and an increase in the number of people per third place is associated with a decrease in incumbent vote share.

\pagebreak

## CEE EU Member States

### Anti-Incumbent Voting: Was the Party Incumbent?
11 CEE EU Member States, NUTS2/3, 1994–2019 (N = 3240)  

```{r echo=FALSE, fig.height=3, message=FALSE, warning=FALSE}
ned_v_dem_cee %>% 
  drop_na(vote_change, prev_incumbent) %>% 
  ggplot(aes(x = prev_incumbent, y = vote_change)) +
  geom_boxplot() +
  xlab("") +
  ylab("Change in Vote Share Compared to Previous Election") +
  scale_x_discrete(labels = c("Not Incumbent", "Incumbent")) +
  theme_minimal() +
  coord_flip()
```

Based on this box plot, we can observe that non-incumbent parties tend to increase their vote share compared to the previous election. On the other hand, incumbent parties seem to get punished by the electorate and more often see a decrease in their vote share. This assumption is supported by a t-test, performed below. The t-test displays a statistically significant result for the difference in means.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Split the scores based on the binary_var
group_true <- ned_v_dem_cee$vote_change[ned_v_dem_cee$prev_incumbent == TRUE]
group_false <- ned_v_dem_cee$vote_change[ned_v_dem_cee$prev_incumbent == FALSE]

# Perform the t-test
result <- t.test(group_true, group_false)
result
```

\pagebreak

### External Emigration

**Crude Emigration per 1000 Population at NUTS3 Level**  

This is an overview of the available external emigration data at NUTS3 level (Poland: NUTS2; Slovenia: NUTS1). Please note that the y-axis varies by country, the x-axis however is the same for all countries. This makes a comparison of available data across different countries easier. Of the eleven CEE EU member states, only ten are displayed as Czechia does not provide data solely on external emigration. Each grey line represents a NUTS region. The red line displays the overall trend over all available years and regions within a country.

```{r echo=FALSE, fig.height=8, message=FALSE, warning=FALSE}
ggplot(cee_crude_emigration, aes(x = year, y = emigration_yearly_per_1000, group = NUTS_ID)) +
  geom_line(color = "light grey") +
  geom_smooth(aes(group = 1), method = "lm", color = "red", se = FALSE, size = 0.5) + 
  facet_wrap(~ country,
             scales = "free_y",
             ncol = 2) +
  ylab(" ") +
  xlab(" ") +
  theme_minimal() 
```

\pagebreak


**Model: Emigration and Incumbent Vote Change**  

I model emigration rates on incumbent vote change across all NUTS3 regions in CEE EU member states. First, I calculate a region’s rolling emigration rate average, taking the average from two consecutive years. E.g., a region’s average emigration rate in the year 2010 is the average of the year 2008 and 2009. I do this to smooth out potential outliers and attempt to model a person’s perception of emigration in a region.

```{r echo=FALSE, message=FALSE, warning=FALSE}
average_emigration <- cee_crude_emigration %>%
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  mutate(average_emigration = slider::slide_dbl(emigration_yearly_per_1000, mean, .before = 2, .after = -1, .complete = T)) %>%
  ungroup()

anti_incumbent_vote <- ned_v_dem_cee %>% 
  dplyr::filter(prev_incumbent == T) %>%
  left_join(average_emigration, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  drop_na(emigration_yearly_per_1000) %>% 
  drop_na(lrgen_fct) %>% 
  mutate(country = str_sub(nuts2016, end = 2))
```


This plot provides a basic overview of the relationship between the average emigration rate and the incumbent's change in vote share. There generally seems to be a positive correlation between the two: An increase in average emigration is associated with higher levels of vote change for incumbent parties. This indicates that incumbent parties achieve better results when emigration increases.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
ggplot(anti_incumbent_vote, aes(x = average_emigration, y = vote_change)) +
  geom_point() +
  geom_smooth(method = "lm", se = F, na.rm = T) +
  xlab("Average Emigration Rate") +
  ylab("Incumbent's Change in Vote Share") +
  theme_minimal()
```

I use the NUTS3 region and the year as fixed effects when building the model, accounting for region- and time-specific factors that may confound the results.

```{r echo=FALSE, message=FALSE, warning=FALSE}
fe_1 <- feols(vote_change ~
                average_emigration |
                nuts2016 + year,
              data = anti_incumbent_vote)

modelsummary(fe_1,
             stars = T,
             title = "DV: Incumbent's Change in Vote Share",
             coef_rename = c(average_emigration = "Average Emigration"),
             gof_omit = "AIC|BIC|RMSE|Std|R2$|R2 Within$")
```

The coefficient is negative, which shows that an increase in the average emigration rate in a NUTS3 region is associated with a decrease in the change of vote share for the incumbent party. This aligns with my theory. The result is statistically significant. The standard errors are clustered at the NUTS3 level, as observations within a region are more similar to each other than to observations in other regions. The overall model fit is 53.34%. However, the “within” model fit is very low (0.24%), which indicates that average emigration does not explain variation in the dependent variable within each fixed-effects group.

\pagebreak

**Model: Emigration, Incumbent Vote Change and Party Orientation**  

As a small excursion, I use data from the Chapel Hill Expert survey to categorise parties by their overall ideological stance: Left, Centre Left, Centre, Centre Right and Right. I add this new information to the model, which uses Centre as the reference category.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
ggplot(anti_incumbent_vote, aes(x = average_emigration, y = vote_change, color = lrgen_fct)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm", se = F, na.rm = T) +
  xlab("Average Emigration Rate") +
  ylab("Incumbent's Change in Vote Share") +
  labs(color = "Party Orientation") +
  theme_minimal()

fe_2 <- feols(vote_change ~
                average_emigration + lrgen_fct |
                nuts2016 + year,
              data = anti_incumbent_vote)

modelsummary(fe_2,
             stars = T,
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(average_emigration = "Average Emigration",
                          `lrgen_fctLeft` = "Left Party",
                          `lrgen_fctCentre Left` = "Centre Left Party",
                          `lrgen_fctCentre Right` = "Centre Right Party",
                          `lrgen_fctRight` = "Right Party"),
             notes = "Reference Category: Centre Party",
             gof_omit = "AIC|BIC|RMSE|Std|R2$|R2 Within$")
```

Average emigration still shows a negative coefficient and is borderline statistically significant ($p = 0.14$). All party coefficients are statistically significant and the overall model fit as well as the “within” model fit have increased compared to the previous model. We can also observe that Left parties fare far worse than other parties when emigration increases.

\pagebreak

## Service Cuts in Poland

```{r echo=FALSE, message=FALSE, warning=FALSE}
options(scipen = 999) # Disable scientific notation
```

### Population Statistics

I now focus on service cuts in Poland, starting with the country’s overall population and primary school population. NUTS2 data is used, because Poland only provides data at this level. Each line represents a Polish NUTS2 region, of which there are 16. A plot's overall trend is displayed with a red trendline.

Contrary to my expectations, the overall population has not decreased in the past 20 years. However, the number of primary aged school children, aged seven to twelve, has decreased.

\pagebreak

**Polish Population in Millions by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_avg_population_change <- pl %>% 
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  mutate(population_change = population - dplyr::lag(population),
         # Calculate the year-on-year percent increase. Multiplying by 100 gives the percent change.
         percent_change = (population_change / dplyr::lag(population)) * 100
         ) %>%
  summarise(
    avg_population_change = mean(population_change, na.rm = TRUE), # Average change in actual numbers
    avg_percent_change = mean(percent_change, na.rm = TRUE) # Average percent change
  )

pl %>% 
  left_join(pl_avg_population_change, by = "NUTS_ID") %>% 
  mutate(population = population / 1000000) %>% 
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>% 
  ggplot(aes(x = year, y = population)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in population (in %) ") +
  pl_plots_components
```

\pagebreak

**Polish Primary Age Population in Thousands by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_schools_avg_population_change <- pl_schools %>% 
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(population_change = population - dplyr::lag(population),
         percent_change = (population_change / dplyr::lag(population)) * 100) %>% # Calculate year-on-year increase
  summarise(avg_population_change = mean(population_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE)) # Calculate average increase

pl_schools %>% 
  left_join(pl_schools_avg_population_change, by = "NUTS_ID") %>% 
  mutate(population = population / 1000) %>% 
  mutate(avg_population_change = avg_population_change / 1000) %>% 
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>% 
  ggplot(aes(x = year, y = population)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in population (in 1000s) ") +
  pl_plots_components
```

\pagebreak

**Polish Emigration per 1000 Population by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_avg_emigration_change <- pl %>% 
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(emigration_change = emigration_yearly_per_1000 - dplyr::lag(emigration_yearly_per_1000),
         percent_change = (emigration_change / dplyr::lag(emigration_yearly_per_1000)) * 100) %>% 
  summarise(avg_emigration_change = mean(emigration_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE)) # Calculate average increase

pl %>% 
  left_join(pl_avg_emigration_change, by = "NUTS_ID") %>% 
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>% 
  ggplot(aes(x = year, y = emigration_yearly_per_1000)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in emigration ") +
  pl_plots_components
```

\pagebreak

### Number of Institutions

**Polish Schools by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_schools_avg_change <- pl_schools %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(school_change = schools - dplyr::lag(schools),
         percent_change = (school_change / dplyr::lag(schools)) * 100) %>% 
  summarise(avg_school_change = mean(school_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

pl_schools %>% 
  left_join(pl_schools_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = schools)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in number of schools ") +
  pl_plots_components
```

\pagebreak

**Polish Hospitals by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_hospitals_avg_change <- pl_hospitals %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(hospital_change = hospitals - dplyr::lag(hospitals),
         percent_change = (hospital_change / dplyr::lag(hospitals)) * 100) %>% 
  summarise(avg_hospital_change = mean(hospital_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

pl_hospitals %>% 
  left_join(pl_hospitals_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = hospitals)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "average of yearly change in number of hospitals ") +
  pl_plots_components
```
\pagebreak

**Polish Third Places by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_third_places_avg_change <- pl_third_places %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(third_places_change = third_places - dplyr::lag(third_places),
         percent_change = (third_places_change / dplyr::lag(third_places)) * 100) %>% 
  summarise(avg_third_places_change = mean(third_places_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

pl_third_places %>% 
  left_join(pl_third_places_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = third_places)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in number of third places ") +
  pl_plots_components +
  theme(legend.position = "bottom")
```


\pagebreak

### Ratios

Also contrary to my expectations, all services that I investigate generally see a decrease in their ratios. This means that over time, there are less people per institution in a NUTS2 region. E.g., less children in a school or less citizens per hospital.

\pagebreak

**Number of Polish Primary School Children per School by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_ratio_schools_avg_change <- pl_schools %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(ratio_school_change = ratio_schools - dplyr::lag(ratio_schools),
         percent_change = (ratio_school_change / dplyr::lag(ratio_schools)) * 100) %>% 
  summarise(avg_ratio_school_change = mean(ratio_school_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

pl_schools %>% 
  left_join(pl_ratio_schools_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = ratio_schools)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in children per school ") +
  pl_plots_components
```
\pagebreak

**Number of People per Hospital by NUTS2 in Poland**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_ratio_hospitals_avg_change <- pl_hospitals %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(ratio_hospital_change = ratio_hospitals_all_population - dplyr::lag(ratio_hospitals_all_population),
         percent_change = (ratio_hospital_change / dplyr::lag(ratio_hospitals_all_population)) * 100) %>% 
  summarise(avg_ratio_hospital_change = mean(ratio_hospital_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

pl_hospitals %>% 
  left_join(pl_ratio_hospitals_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = ratio_hospitals_all_population)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in people per hospital ") +
  pl_plots_components
```

\pagebreak

**Number of People per Third Place by NUTS2 in Poland**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
pl_ratio_third_places_avg_change <- pl_third_places %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(ratio_third_places_change = ratio_third_places - dplyr::lag(ratio_third_places),
         percent_change = (ratio_third_places_change / dplyr::lag(ratio_third_places)) * 100) %>% 
  summarise(avg_ratio_third_places_change = mean(ratio_third_places_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

pl_third_places %>% 
  left_join(pl_ratio_third_places_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = ratio_third_places)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in people per third place ") +
  pl_plots_components +
  theme(legend.position = "bottom")
```

\pagebreak

### Control Variables

Both remittances and GDP show an increase over time. I use these data as control variables in my models. Data on remittances are only available at the national level.

**Remittance Inflows (US$ million) for all of Poland**  
```{r echo=FALSE, fig.height=3, message=FALSE, warning=FALSE}
ggplot(pl_remittances, aes(x = year, y = remittances)) +
  geom_line(color = "light grey") +
  geom_smooth(aes(group = 1), method = "loess", color = "red", se = FALSE, size = 0.5) + 
  scale_y_continuous(labels = label_comma()) + ylab("") + xlab("") + theme_minimal()
```

**GDP at Current Market Prices in Poland by NUTS 2 (Euros per Inhabitant)**  
```{r echo=FALSE, fig.height=3, message=FALSE, warning=FALSE}
ggplot(pl_gdp, aes(x = year, y = gdp, line = NUTS_ID)) +
  geom_line(color = "light grey") +
  geom_smooth(aes(group = 1), method = "loess", color = "red", se = FALSE, size = 0.5) + 
  scale_y_continuous(labels = label_comma()) + ylab("") + xlab("") + theme_minimal()
```

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
options(scipen = 0) # Enable scientific notation

# Calculate the average crude_net_migration for each NUTS_ID for every pair of consecutive years
average_emigration <- pl %>%
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  # Take rolling average of past 2 years into account, ignore current year
  mutate(average_emigration = slider::slide_dbl(emigration_yearly_per_1000, mean, .before = 2, .after = -1, .complete = T)) %>%
  ungroup()

anti_incumbent_vote <- ned_v_dem_cee %>% 
  dplyr::filter(prev_incumbent == T) %>%
  left_join(average_emigration, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  drop_na(emigration_yearly_per_1000)

anti_incumbent_vote <- anti_incumbent_vote %>% 
  left_join(dplyr::select(pl_schools, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>%
  left_join(dplyr::select(pl_hospitals, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(dplyr::select(pl_third_places, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(pl_remittances, by = "year") %>% 
  left_join(pl_gdp, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  dplyr::filter(nuts2016 != "PL91") # Remove potentially problematic NUTS2 region (Warszawski stołeczny)

fe_lm_1 <- feols(vote_change ~
                   ratio_schools +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_2 <- feols(vote_change ~
                   ratio_hospitals_all_population +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_3 <- feols(vote_change ~
                   ratio_third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_4 <- feols(vote_change ~
                   ratio_schools +
                   ratio_hospitals_all_population +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_5 <- feols(vote_change ~
                   ratio_schools +
                   ratio_third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_6 <- feols(vote_change ~
                   ratio_hospitals_all_population +
                   ratio_third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_7 <- feols(vote_change ~
                ratio_schools +
                ratio_hospitals_all_population +
                ratio_third_places +
                emigration_election_year_per_1000 +
                remittances +
                gdp | 
                nuts2016 + year,
              data = anti_incumbent_vote)
```

### LM Models: Anti-Incumbent Voting in Poland at NUTS2 Level: Ratios

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_1, fe_lm_2, fe_lm_3),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals_all_population = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

I first model separate ratios on incumbent vote change while controlling for emigration and GDP. Models 1, 2 and 3 each use a ratio separately. NUTS2 regions and years are used as fixed effects in all models. The emigration rate is the rolling emigration average between two national elections. Remittances are removed due to collinearity.

Some coefficients point in the right direction but overall no results are statistically significant at conventional levels. An increase in the number of children per school is associated with a decrease in the incumbent vote share. However, the p-value is high ($p = 0.197$). Both hospital and third places ratios have coefficients of 0, displaying no effect on incumbent vote share.

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_4, fe_lm_5, fe_lm_6, fe_lm_7),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals_all_population = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between\nElection Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

In a second step, I use different combinations of ratios (models 1, 2 and 3) and finally combine all ratios in model 4. Again, NUTS2 regions and years are used as fixed effects. Both school ratio and third places ratio display statistically significant and negative coefficients, which align with my theory. This means that an increase in the number of children per school and an increase of the number of people per third place is associated with a decrease in the incumbent vote share, while controlling for emigration and GDP. The third ratio, number of people per hospital, still shows no effect.


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
cat("Coefficient Plot for Model 4 (Table 4)")
modelplot(fe_lm_7,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Rate between\nElection Years per 1000 People",
                       ratio_third_places = "People per Third Places",
                       ratio_hospitals_all_population = "People per Hospital",
                       ratio_schools = "Children per School"))
```

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Models using number of institutions
options(scipen = 0) # Enable scientific notation

# Calculate the average crude_net_migration for each NUTS_ID for every pair of consecutive years
average_emigration <- pl %>%
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  # Take rolling average of past 2 years into account, ignore current year
  mutate(average_emigration = slider::slide_dbl(emigration_yearly_per_1000, mean, .before = 2, .after = -1, .complete = T)) %>%
  ungroup()

anti_incumbent_vote <- ned_v_dem_cee %>% 
  dplyr::filter(prev_incumbent == T) %>%
  left_join(average_emigration, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  drop_na(emigration_yearly_per_1000)

anti_incumbent_vote <- anti_incumbent_vote %>% 
  left_join(dplyr::select(pl_schools, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>%
  left_join(dplyr::select(pl_hospitals, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(dplyr::select(pl_third_places, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(pl_remittances, by = "year") %>% 
  left_join(pl_gdp, by = c("year" = "year", "nuts2016" = "NUTS_ID"))

fe_lm_1 <- feols(vote_change ~
                   schools +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_2 <- feols(vote_change ~
                   hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_3 <- feols(vote_change ~
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_4 <- feols(vote_change ~
                   schools +
                   hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_5 <- feols(vote_change ~
                   schools +
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_6 <- feols(vote_change ~
                   hospitals +
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_7 <- feols(vote_change ~
                schools +
                hospitals +
                third_places +
                emigration_election_year_per_1000 +
                remittances +
                gdp | 
                nuts2016 + year,
              data = anti_incumbent_vote)
```

### LM Models: Anti-Incumbent Voting in Poland at NUTS2 Level: Number of Institutions

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_1, fe_lm_2, fe_lm_3),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_4, fe_lm_5, fe_lm_6, fe_lm_7),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
cat("Coefficient Plot for Model 4 (Table 4)")
modelplot(fe_lm_7,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Election Year",
                       third_places = "Number of Third Places",
                       hospitals = "Number of Hospitals",
                       schools = "Number of Schools"))
```

### Truncating Data
Do models improve when truncating parts of the data? I truncate the data in three different ways to explore if results vary. Model 1 uses data where observations with a small vote change, between $-2$ and $2$, are removed. This is done to see if extreme vote change values lead to more significant results. Model 2 uses data in which observations with extremely high (over $25\%$) and extremely low (under $5\%$) vote shares are removed. Model 3 uses data where high levels of emigration rates are removed. Both models 2 and 3 attempt to remove outliers in order to build models with higher validity.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Truncate Vote Change
# Models using ratios
cutoff <- 2
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_change > cutoff | vote_change < cutoff * -1)

lm_truncate_vote_change <- feols(vote_change ~
                                   ratio_schools +
                                   ratio_hospitals_all_population +
                                   ratio_third_places +
                                   emigration_election_year_per_1000 +
                                   remittances +
                                   gdp | 
                                   nuts2016 + year,
                                 data = anti_incumbent_vote_truncated)

# Truncate Vote Share
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_share < 25 & vote_share > 5)

lm_truncate_vote_share <- feols(vote_change ~
                                  ratio_schools +
                                  ratio_hospitals_all_population +
                                  ratio_third_places +
                                  emigration_election_year_per_1000 +
                                  remittances +
                                  gdp | 
                                  nuts2016 + year,
                                data = anti_incumbent_vote_truncated)

# Truncate Emigration Rate
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(emigration_election_year_per_1000 < 4)

lm_truncate_emigration_rate <- feols(vote_change ~
                                       ratio_schools +
                                       ratio_hospitals_all_population +
                                       ratio_third_places +
                                       emigration_election_year_per_1000 +
                                       remittances +
                                       gdp | 
                                       nuts2016 + year,
                                     data = anti_incumbent_vote_truncated)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(lm_truncate_vote_change, lm_truncate_vote_share, lm_truncate_emigration_rate),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals_all_population = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Truncate Vote Change
# Models using number of institutions
cutoff <- 2
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_change > cutoff | vote_change < cutoff * -1)

lm_truncate_vote_change <- feols(vote_change ~
                                   schools +
                                   hospitals +
                                   third_places +
                                   emigration_election_year_per_1000 +
                                   remittances +
                                   gdp | 
                                   nuts2016 + year,
                                 data = anti_incumbent_vote_truncated)

# Truncate Vote Share
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_share < 25 & vote_share > 5)

lm_truncate_vote_share <- feols(vote_change ~
                                  schools +
                                  hospitals +
                                  third_places +
                                  emigration_election_year_per_1000 +
                                  remittances +
                                  gdp | 
                                  nuts2016 + year,
                                data = anti_incumbent_vote_truncated)

# Truncate Emigration Rate
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(emigration_election_year_per_1000 < 4)

lm_truncate_emigration_rate <- feols(vote_change ~
                                       schools +
                                       hospitals +
                                       third_places +
                                       emigration_election_year_per_1000 +
                                       remittances +
                                       gdp | 
                                       nuts2016 + year,
                                     data = anti_incumbent_vote_truncated)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(lm_truncate_vote_change, lm_truncate_vote_share, lm_truncate_emigration_rate),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

Truncated model 1, which focuses on extreme values, shows the most promising results. The school ratio and third places ratio coefficients become more pronounced and have higher statistical significance compared to the models using all observations. The emigration coefficient also becomes statistically significant, which is an improvement compared to the non-truncated models.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=2}
cat("Coefficient Plot for Model 1 (Table 5)")
modelplot(lm_truncate_vote_change,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Rate between\nElection Years per 1000 People",
                       ratio_third_places = "People per Third Places",
                       ratio_hospitals_all_population = "People per Hospital",
                       ratio_schools = "Children per School"))
```

\pagebreak

## Service Cuts in Romania

### Population Statistics
…

\pagebreak

**Romanian Population in Millions by NUTS2**  
```{r echo=FALSE, fig.height = 9, message=FALSE, warning=FALSE}
ro_avg_population_change <- ro_population %>% 
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  mutate(population_change = population - dplyr::lag(population),
         # Calculate the year-on-year percent increase. Multiplying by 100 gives the percent change.
         percent_change = (population_change / dplyr::lag(population)) * 100
         ) %>%
  summarise(
    avg_population_change = mean(population_change, na.rm = TRUE), # Average change in actual numbers
    avg_percent_change = mean(percent_change, na.rm = TRUE) # Average percent change
  )

ro_population %>% 
  left_join(ro_avg_population_change, by = "NUTS_ID") %>% 
  mutate(population = population / 1000000) %>% 
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>% 
  ggplot(aes(x = year, y = population)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in population (in %) ") +
  ro_plots_components
```
\pagebreak

**Romanian Primary Age Population in Thousands by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_schools_avg_population_change <- ro_schools %>% 
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(population_change = population - dplyr::lag(population),
         percent_change = (population_change / dplyr::lag(population)) * 100) %>% # Calculate year-on-year increase
  summarise(avg_population_change = mean(population_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE)) # Calculate average increase

ro_schools %>% 
  left_join(ro_schools_avg_population_change, by = "NUTS_ID") %>% 
  mutate(population = population / 1000) %>% 
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>% 
  ggplot(aes(x = year, y = population)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in population (in 1000s) ") +
  ro_plots_components
```

\pagebreak

**Romanian Emigration per 1000 Population by NUTS2**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_avg_emigration_change <- ro %>% 
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(emigration_change = emigration_yearly_per_1000 - dplyr::lag(emigration_yearly_per_1000),
         percent_change = (emigration_change / dplyr::lag(emigration_yearly_per_1000)) * 100) %>% 
  summarise(avg_emigration_change = mean(emigration_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE)) # Calculate average increase

ro %>% 
  left_join(ro_avg_emigration_change, by = "NUTS_ID") %>% 
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>% 
  ggplot(aes(x = year, y = emigration_yearly_per_1000)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in emigration ") +
  ro_plots_components
```

\pagebreak

### Number of Institutions

**Romanian Schools by NUTS3**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_schools_avg_change <- ro_schools %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(school_change = schools - dplyr::lag(schools),
         percent_change = (school_change / dplyr::lag(schools)) * 100) %>% 
  summarise(avg_school_change = mean(school_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

ro_schools %>% 
  left_join(ro_schools_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = schools)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in number of schools ") +
  ro_plots_components +
  scale_x_continuous(breaks = c(1990, 2022)) # Adjust x-axis for dates
```

\pagebreak

**Romanian Hospitals at NUTS3**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_hospitals_avg_change <- ro_hospitals %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(hospital_change = hospitals - dplyr::lag(hospitals),
         percent_change = (hospital_change / dplyr::lag(hospitals)) * 100) %>% 
  summarise(avg_hospital_change = mean(hospital_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

ro_hospitals %>% 
  left_join(ro_hospitals_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = hospitals)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "average of yearly change in number of hospitals ") +
  ro_plots_components +
  scale_x_continuous(breaks = c(1990, 2022))  # Adjust x-axis for dates
```
\pagebreak

**Romanian Third Places at NUTS3**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_third_places_avg_change <- ro_third_places %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(third_places_change = third_places - dplyr::lag(third_places),
         percent_change = (third_places_change / dplyr::lag(third_places)) * 100) %>% 
  summarise(avg_third_places_change = mean(third_places_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

ro_third_places %>% 
  left_join(ro_third_places_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = third_places)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in number of third places ") +
  ro_plots_components +
  scale_x_continuous(breaks = c(2008, 2021))  # Adjust x-axis for dates
```
### Ratios

…

\pagebreak

**Number of Romanian Primary School Children per School at NUTS3**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_ratio_schools_avg_change <- ro_schools %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(ratio_school_change = ratio_schools - dplyr::lag(ratio_schools),
         percent_change = (ratio_school_change / dplyr::lag(ratio_schools)) * 100) %>% 
  summarise(avg_ratio_school_change = mean(ratio_school_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

ro_schools %>% 
  left_join(ro_ratio_schools_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = ratio_schools)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in children per school ") +
  ro_plots_components +
  scale_x_continuous(breaks = c(1995, 2022))  # Adjust x-axis for dates
```
\pagebreak

**Number of People per Hospital by NUTS3 in Romania**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_ratio_hospitals_avg_change <- ro_hospitals %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(ratio_hospital_change = ratio_hospitals - dplyr::lag(ratio_hospitals),
         percent_change = (ratio_hospital_change / dplyr::lag(ratio_hospitals)) * 100) %>% 
  summarise(avg_ratio_hospital_change = mean(ratio_hospital_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

ro_hospitals %>% 
  left_join(ro_ratio_hospitals_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = ratio_hospitals)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in people per hospital ") +
  ro_plots_components +
  scale_x_continuous(breaks = c(2000, 2022)) # Adjust x-axis for dates
```

\pagebreak

**Number of People per Third Place by NUTS3 in Romania**  
```{r echo=FALSE, fig.height = 8, message=FALSE, warning=FALSE}
ro_ratio_third_places_avg_change <- ro_third_places %>%
  arrange(NUTS_ID, year) %>% # Arrange data by region and then by year
  group_by(NUTS_ID) %>% # Group data by region
  mutate(ratio_third_places_change = ratio_third_places - dplyr::lag(ratio_third_places),
         percent_change = (ratio_third_places_change / dplyr::lag(ratio_third_places)) * 100) %>% 
  summarise(avg_ratio_third_places_change = mean(ratio_third_places_change, na.rm = TRUE),
            avg_percent_change = mean(percent_change, na.rm = TRUE))

ro_third_places %>% 
  left_join(ro_ratio_third_places_avg_change, by = "NUTS_ID") %>%
  mutate(NUTS_ID = reorder(NUTS_ID, -avg_percent_change)) %>%
  ggplot(aes(x = year, y = ratio_third_places)) +
  geom_smooth(aes(color = avg_percent_change), method = "loess", se = FALSE) +
  scale_color_gradient(name = "Average of yearly change in people per third place ") +
  pl_plots_components +
  scale_x_continuous(breaks = c(2008, 2020)) # Adjust x-axis for dates
```

\pagebreak

### Control Variables

…

**Remittance Inflows (US$ million) for all of Romania**  
```{r echo=FALSE, fig.height=3, message=FALSE, warning=FALSE}
ggplot(ro_remittances, aes(x = year, y = remittances)) +
  geom_line() +
  scale_y_continuous(labels = label_comma()) + ylab("") + xlab("") + theme_minimal()
```

**GDP at Current Market Prices in Romania at NUTS3 (Euros per Inhabitant)**  
```{r echo=FALSE, fig.height=3, message=FALSE, warning=FALSE}
ggplot(ro_gdp, aes(x = year, y = gdp, line = NUTS_ID)) +
  geom_line(color = "light grey") +
  geom_smooth(aes(group = 1), method = "loess", color = "red", se = FALSE, size = 0.5) + 
  scale_y_continuous(labels = label_comma()) + ylab("") + xlab("") + theme_minimal()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Models using ratios
options(scipen = 0) # Enable scientific notation

# Calculate the average crude_net_migration for each NUTS_ID for every pair of consecutive years
average_emigration <- ro %>%
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  # Take rolling average of past 2 years into account, ignore current year
  mutate(average_emigration = slider::slide_dbl(emigration_yearly_per_1000, mean, .before = 2, .after = -1, .complete = T)) %>%
  ungroup()

anti_incumbent_vote <- ned_v_dem_cee %>% 
  dplyr::filter(prev_incumbent == T) %>%
  left_join(average_emigration, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  drop_na(emigration_yearly_per_1000)

anti_incumbent_vote <- anti_incumbent_vote %>% 
  left_join(dplyr::select(ro_schools, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>%
  left_join(dplyr::select(ro_hospitals, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(dplyr::select(ro_third_places, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(ro_remittances, by = "year") %>% 
  left_join(ro_gdp, by = c("year" = "year", "nuts2016" = "NUTS_ID"))

fe_lm_1 <- feols(vote_change ~
                   ratio_schools +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_2 <- feols(vote_change ~
                   ratio_hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_3 <- feols(vote_change ~
                   ratio_third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_4 <- feols(vote_change ~
                   ratio_schools +
                   ratio_hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_5 <- feols(vote_change ~
                   ratio_schools +
                   ratio_third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_6 <- feols(vote_change ~
                   ratio_hospitals +
                   ratio_third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_7 <- feols(vote_change ~
                ratio_schools +
                ratio_hospitals +
                ratio_third_places +
                emigration_election_year_per_1000 +
                remittances +
                gdp | 
                nuts2016 + year,
              data = anti_incumbent_vote)
```

### LM Models: Anti-Incumbent Voting in Romania at NUTS3 Level: Ratios

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_1, fe_lm_2, fe_lm_3),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_4, fe_lm_5, fe_lm_6, fe_lm_7),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
cat("Coefficient Plot for Model 4 (Table 4)")
modelplot(fe_lm_7,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Election Year",
                       ratio_third_places = "People per Third Places",
                       ratio_hospitals = "People per Hospital",
                       ratio_schools = "Children per School"))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Models using number of institutions
options(scipen = 0) # Enable scientific notation

# Calculate the average crude_net_migration for each NUTS_ID for every pair of consecutive years
average_emigration <- ro %>%
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  # Take rolling average of past 2 years into account, ignore current year
  mutate(average_emigration = slider::slide_dbl(emigration_yearly_per_1000, mean, .before = 2, .after = -1, .complete = T)) %>%
  ungroup()

anti_incumbent_vote <- ned_v_dem_cee %>% 
  dplyr::filter(prev_incumbent == T) %>%
  left_join(average_emigration, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  drop_na(emigration_yearly_per_1000)

anti_incumbent_vote <- anti_incumbent_vote %>% 
  left_join(dplyr::select(ro_schools, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>%
  left_join(dplyr::select(ro_hospitals, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(dplyr::select(ro_third_places, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(ro_remittances, by = "year") %>% 
  left_join(ro_gdp, by = c("year" = "year", "nuts2016" = "NUTS_ID"))

fe_lm_1 <- feols(vote_change ~
                   schools +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_2 <- feols(vote_change ~
                   hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_3 <- feols(vote_change ~
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_4 <- feols(vote_change ~
                   schools +
                   hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_5 <- feols(vote_change ~
                   schools +
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_6 <- feols(vote_change ~
                   hospitals +
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_7 <- feols(vote_change ~
                schools +
                hospitals +
                third_places +
                emigration_election_year_per_1000 +
                remittances +
                gdp | 
                nuts2016 + year,
              data = anti_incumbent_vote)
```

### LM Models: Anti-Incumbent Voting in Romania at NUTS3 Level: Number of Institutions

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_1, fe_lm_2, fe_lm_3),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_4, fe_lm_5, fe_lm_6, fe_lm_7),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
cat("Coefficient Plot for Model 4 (Table 4)")
modelplot(fe_lm_7,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Election Year",
                       third_places = "Number of Third Places",
                       hospitals = "Number of Hospitals",
                       schools = "Number of Schools"))
```

\pagebreak

### Truncating Data
…

```{r echo=FALSE, message=FALSE, warning=FALSE}
hist(anti_incumbent_vote$vote_change, breaks = 50)
summary(anti_incumbent_vote$vote_change)

ggplot(anti_incumbent_vote) +
  geom_histogram(aes(x = vote_change), binwidth = 1) +
  # xlim(-1,1) +
  theme_minimal()

ggplot(anti_incumbent_vote) +
  geom_histogram(aes(x = vote_share), binwidth = 1) +
  # xlim(-1,1) +
  theme_minimal()

ggplot(anti_incumbent_vote) +
  geom_histogram(aes(x = emigration_election_year_per_1000)) +
  # xlim(-1,1) +
  theme_minimal()
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Truncate Vote Change
# Models using ratios
cutoff <- 0.5
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_change > cutoff | vote_change < cutoff * -1)

lm_truncate_vote_change <- feols(vote_change ~
                                   ratio_schools +
                                   ratio_hospitals +
                                   ratio_third_places +
                                   emigration_election_year_per_1000 +
                                   remittances +
                                   gdp | 
                                   nuts2016 + year,
                                 data = anti_incumbent_vote_truncated)

# Truncate Vote Share
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_share < 30 & vote_share > 5)

lm_truncate_vote_share <- feols(vote_change ~
                                  ratio_schools +
                                  ratio_hospitals +
                                  ratio_third_places +
                                  emigration_election_year_per_1000 +
                                  remittances +
                                  gdp | 
                                  nuts2016 + year,
                                data = anti_incumbent_vote_truncated)

# Truncate Emigration Rate
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(emigration_election_year_per_1000 < 2)

lm_truncate_emigration_rate <- feols(vote_change ~
                                       ratio_schools +
                                       ratio_hospitals +
                                       ratio_third_places +
                                       emigration_election_year_per_1000 +
                                       remittances +
                                       gdp | 
                                       nuts2016 + year,
                                     data = anti_incumbent_vote_truncated)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(lm_truncate_vote_change, lm_truncate_vote_share, lm_truncate_emigration_rate),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Truncate Vote Change
# Models using number of institutions
cutoff <- 0.5
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_change > cutoff | vote_change < cutoff * -1)

lm_truncate_vote_change <- feols(vote_change ~
                                   schools +
                                   hospitals +
                                   third_places +
                                   emigration_election_year_per_1000 +
                                   remittances +
                                   gdp | 
                                   nuts2016 + year,
                                 data = anti_incumbent_vote_truncated)

# Truncate Vote Share
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_share < 30 & vote_share > 5)

lm_truncate_vote_share <- feols(vote_change ~
                                  schools +
                                  hospitals +
                                  third_places +
                                  emigration_election_year_per_1000 +
                                  remittances +
                                  gdp | 
                                  nuts2016 + year,
                                data = anti_incumbent_vote_truncated)

# Truncate Emigration Rate
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(emigration_election_year_per_1000 < 2)

lm_truncate_emigration_rate <- feols(vote_change ~
                                       schools +
                                       hospitals +
                                       third_places +
                                       emigration_election_year_per_1000 +
                                       remittances +
                                       gdp | 
                                       nuts2016 + year,
                                     data = anti_incumbent_vote_truncated)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(lm_truncate_vote_change, lm_truncate_vote_share, lm_truncate_emigration_rate),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

## Next Steps
These are possible next steps and open questions, based on my considerations and input from the Kolloquium.

- Am I operationalize service cuts correctly? A higher ratio does not necessarily always imply (for example) less schools.
- Explore further data manipulation based on the truncated data. Are there more data in the outliers? Are there any region-specific data I should take into account? Should I look into large service cuts, as these will have a bigger effect on the population than small service cuts?
- Should I take party orientation into account? A party's orientation will have an effect on service cuts.
- Is time being correctly modelled?
- Should I explore service cuts in another country? Perhaps a country that sees an increase in emigration rates?

\pagebreak

## Sources

### Page 2
**V–Party Dataset**  
Staffan I. Lindberg, Nils Du ̈pont, Masaaki Higashijima, Yaman Berker Kavasoglu, Kyle L. Marquardt, Michael Bernhard, Holger D ̈oring, Allen Hicken, Melis Laebens, Juraj Medzihorsky, Anja Neundorf, Ora John Reuter, Saskia Ruth–Lovell, Keith R. Weghorst, Nina Wiesehomeier, Joseph Wright, Nazifa Alizada, Paul Bederke, Lisa Gastaldi, Sandra Grahn, Garry Hindle, Nina Ilchenko, Johannes von R ̈omer, Steven Wilson, Daniel Pemstein, Brigitte Seim. 2022. Varieties of Party Identity and Organization (V–Party) Dataset V2. Varieties of Democracy (V–Dem) Project. https://doi.org/10.23696/vpartydsv2
and:
Pemstein, Daniel, Kyle L. Marquardt, Eitan Tzelgov, Yi–ting Wang, Juraj Medzihorsky, Joshua Krusell, Farhad Miri, and Johannes von R ̈omer. 2020. “The V-Dem Measurement Model: Latent Variable Analysis for Cross-National and Cross–Temporal Expert-Coded Data”. V- Dem Working Paper No. 21. 5th edition. University of Gothenburg: Varieties of Democracy Institute.  

**EU-NED European NUTS-Level Election Dataset**  
Schraff, Dominik; Vergioglou, Ioannis; Demirci, Buket Buse, 2022, "EU-NED: The European NUTS-Level Election Dataset", https://doi.org/10.7910/DVN/IQRYP5, Harvard Dataverse, V1, UNF:6:33YFLJUZN1V4UrerfOsbxg== [fileUNF]

**Party Facts**  
https://partyfacts.herokuapp.com/data/partycodes/[pf_party_id]/  

### Page 3  
**Bulgaria**  
https://www.nsi.bg/en/content/3060/migration-population-districts-municipalities-and-sex (retrieved 2 November 2023)  
https://www.nsi.bg/en/content/2975/population-districts-municipalities-place-residence-and-sex (retrieved 2 November 2023)  

**Estonia**  
RVR01; https://andmed.stat.ee/en/stat/Lepetatud_tabelid__Rahvastik.Arhiiv__Rahvastikus%C3%BCndmused.%20Arhiiv/RVR01 (retrieved 7 November 2023)  
RVR02; https://andmed.stat.ee/en/stat/rahvastik__rahvastikusundmused__ranne/RVR02/table/tableViewLayout2 (retrieved 7 November 2023)  
RV022: POPULATION, 1 JANUARY by Year, County, Sex and Age group; https://andmed.stat.ee/en/stat/Lepetatud_tabelid__Rahvastik.Arhiiv__Rahvastikun%C3%A4itajad%20ja%20koosseis.%20Arhiiv/RV022/table/tableViewLayout2 (retrieved 7 November 2023)  
RV022U: POPULATION, 1 JANUARY. ADMINISTRATIVE DIVISION AS AT 01.01.2018 by Year, County, Sex and Age group; https://andmed.stat.ee/en/stat/rahvastik__rahvastikunaitajad-ja-koosseis__rahvaarv-ja-rahvastiku-koosseis/RV022U/table/tableViewLayout2 (retrieved 7 November 2023)  

**Croatia**  
https://podaci.dzs.hr/media/ueajlqe5/stanovnistvo-pregled-po-zupanijama.xlsx (retrieved 3 November 2023)  
https://podaci.dzs.hr/media/ueajlqe5/stanovnistvo-pregled-po-zupanijama.xlsx (retrieved 3 November 2023)  

**Hungary**  
https://statinfo.ksh.hu/Statinfo/haViewer.jsp (retrieved 7 November 2023)  
https://www.ksh.hu/stadat_files/nep/en/nep0034.html (retrieved 16 November 2023)  

\pagebreak

**Lithuania**  
https://osp.stat.gov.lt/statistiniu-rodikliu-analize#/ (retrieved 9 November 2023)  

**Latvia**  
https://data.stat.gov.lv/pxweb/en/OSP_PUB/START__POP__IB__IBE/IBE080/table/tableViewLayout1/ (retrieved 9 November 2023)  
https://data.stat.gov.lv/pxweb/en/OSP_PUB/START__POP__IR__IRS/IRS030/table/tableViewLayout1/ (retrieved 9 November 2023)  

**Poland**  
https://bdl.stat.gov.pl/bdl/dane/podgrup/tablica (retrieved 17 November 2023)  

**Romania**  
http://statistici.insse.ro:8077/tempo-online/#/pages/tables/insse-table (retrieved 13 November 2023)  

**Slovenia**  
https://pxweb.stat.si/SiStatData/pxweb/en/Data/Data/05N1042S.px/table/tableViewLayout2/ (retrieved 10 November 2023)  
https://pxweb.stat.si/SiStatData/pxweb/en/Data/Data/05E1016S.px/table/tableViewLayout2/ (retrieved 10 November 2023)  

**Slovakia**  
https://datacube.statistics.sk/#!/view/en/vbd_dem/om7021rr/v_om7021rr_00_00_00_en (retrieved 10 November 2023)  

### Page 5

**1999-2019 Chapel Hill Expert Survey (CHES) trend file**  
Jolly, Seth, Ryan Bakker, Liesbet Hooghe, Gary Marks, Jonathan Polk, Jan Rovny, Marco Steenbergen, and Milada Anna Vachudova. 2022. “Chapel Hill Expert Survey Trend File, 1999-2019.” Electoral Studies 75 (February). https://doi.org/10.1016/j.electstud.2021.102420  

### Page 6

**Entire Population**
https://bdl.stat.gov.pl/bdl/dane/podgrup/tablica (retrieved 17 November 2023)  

**Primary Age Population**
https://ec.europa.eu/eurostat/databrowser/view/demo_r_d2jan__custom_8622439/default/table?lang=en (retrieved 21 November 2023)

### Page 7  

**Schools**  
https://bdl.stat.gov.pl/bdl/dane/podgrup/tablica (retrieved 20 November 2023)  

**Hospitals**  
https://bdl.stat.gov.pl/bdl/dane/podgrup/tablica (retrieved 24 November 2023)  

**Third Places**  
https://bdl.stat.gov.pl/bdl/dane/podgrup/tablica (retrieved 27 November 2023)  

### Page 8

**Remittances**  
https://www.knomad.org/data/remittances (retrieved 27 November 2023)  

**GDP**  
https://ec.europa.eu/eurostat/databrowser/view/nama_10r_2gdp__custom_8716685/default/table?lang=en (retrieved 27 November 2023)  
