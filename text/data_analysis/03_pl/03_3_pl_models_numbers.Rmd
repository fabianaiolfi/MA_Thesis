### LM Models: Anti-Incumbent Voting in Poland at NUTS2 Level: Number of Institutions


```{r echo=FALSE, message=FALSE, warning=FALSE}
# Models using number of institutions
options(scipen = 0) # Enable scientific notation

# Calculate the average crude_net_migration for each NUTS_ID for every pair of consecutive years
average_emigration <- pl %>%
  arrange(NUTS_ID, year) %>%
  group_by(NUTS_ID) %>%
  # Take rolling average of past 2 years into account, ignore current year
  mutate(average_emigration = slider::slide_dbl(emigration_yearly_per_1000, mean, .before = 2, .after = -1, .complete = T)) %>%
  ungroup()

anti_incumbent_vote <- ned_v_dem_cee %>% 
  dplyr::filter(prev_incumbent == T) %>%
  left_join(average_emigration, by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  drop_na(emigration_yearly_per_1000)

anti_incumbent_vote <- anti_incumbent_vote %>% 
  left_join(dplyr::select(pl_schools, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>%
  left_join(dplyr::select(pl_hospitals, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(dplyr::select(pl_third_places, -population), by = c("year" = "year", "nuts2016" = "NUTS_ID")) %>% 
  left_join(pl_remittances, by = "year") %>% 
  left_join(pl_gdp, by = c("year" = "year", "nuts2016" = "NUTS_ID"))

fe_lm_1 <- feols(vote_change ~
                   schools +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_2 <- feols(vote_change ~
                   hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_3 <- feols(vote_change ~
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_4 <- feols(vote_change ~
                   schools +
                   hospitals +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_5 <- feols(vote_change ~
                   schools +
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_6 <- feols(vote_change ~
                   hospitals +
                   third_places +
                   emigration_election_year_per_1000 +
                   remittances +
                   gdp | 
                   nuts2016 + year,
                 data = anti_incumbent_vote)

fe_lm_7 <- feols(vote_change ~
                schools +
                hospitals +
                third_places +
                emigration_election_year_per_1000 +
                remittances +
                gdp | 
                nuts2016 + year,
              data = anti_incumbent_vote)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_1, fe_lm_2, fe_lm_3),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…

\pagebreak

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(fe_lm_4, fe_lm_5, fe_lm_6, fe_lm_7),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Election Year",
                          gdp = "GDP"),
             stars = T)
```

…


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}
cat("Coefficient Plot for Model 4 (Table 4)")
modelplot(fe_lm_7,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Election Year",
                       third_places = "Number of Third Places",
                       hospitals = "Number of Hospitals",
                       schools = "Number of Schools"))
```

### Truncating Data
Do models improve when truncating parts of the data? I truncate the data in three different ways to explore if results vary. Model 1 uses data where observations with a small vote change, between $-2$ and $2$, are removed. This is done to see if extreme vote change values lead to more significant results. Model 2 uses data in which observations with extremely high (over $25\%$) and extremely low (under $5\%$) vote shares are removed. Model 3 uses data where high levels of emigration rates are removed. Both models 2 and 3 attempt to remove outliers in order to build models with higher validity.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Truncate Vote Change
# Models using ratios
cutoff <- 2
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_change > cutoff | vote_change < cutoff * -1)

lm_truncate_vote_change <- feols(vote_change ~
                                   ratio_schools +
                                   ratio_hospitals_all_population +
                                   ratio_third_places +
                                   emigration_election_year_per_1000 +
                                   remittances +
                                   gdp | 
                                   nuts2016 + year,
                                 data = anti_incumbent_vote_truncated)

# Truncate Vote Share
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_share < 25 & vote_share > 5)

lm_truncate_vote_share <- feols(vote_change ~
                                  ratio_schools +
                                  ratio_hospitals_all_population +
                                  ratio_third_places +
                                  emigration_election_year_per_1000 +
                                  remittances +
                                  gdp | 
                                  nuts2016 + year,
                                data = anti_incumbent_vote_truncated)

# Truncate Emigration Rate
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(emigration_election_year_per_1000 < 4)

lm_truncate_emigration_rate <- feols(vote_change ~
                                       ratio_schools +
                                       ratio_hospitals_all_population +
                                       ratio_third_places +
                                       emigration_election_year_per_1000 +
                                       remittances +
                                       gdp | 
                                       nuts2016 + year,
                                     data = anti_incumbent_vote_truncated)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(lm_truncate_vote_change, lm_truncate_vote_share, lm_truncate_emigration_rate),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(ratio_schools = "Children per School",
                          ratio_hospitals_all_population = "People per Hospital",
                          ratio_third_places = "People per Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Truncate Vote Change
# Models using number of institutions
cutoff <- 2
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_change > cutoff | vote_change < cutoff * -1)

lm_truncate_vote_change <- feols(vote_change ~
                                   schools +
                                   hospitals +
                                   third_places +
                                   emigration_election_year_per_1000 +
                                   remittances +
                                   gdp | 
                                   nuts2016 + year,
                                 data = anti_incumbent_vote_truncated)

# Truncate Vote Share
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(vote_share < 25 & vote_share > 5)

lm_truncate_vote_share <- feols(vote_change ~
                                  schools +
                                  hospitals +
                                  third_places +
                                  emigration_election_year_per_1000 +
                                  remittances +
                                  gdp | 
                                  nuts2016 + year,
                                data = anti_incumbent_vote_truncated)

# Truncate Emigration Rate
anti_incumbent_vote_truncated <- anti_incumbent_vote %>% 
  dplyr::filter(emigration_election_year_per_1000 < 4)

lm_truncate_emigration_rate <- feols(vote_change ~
                                       schools +
                                       hospitals +
                                       third_places +
                                       emigration_election_year_per_1000 +
                                       remittances +
                                       gdp | 
                                       nuts2016 + year,
                                     data = anti_incumbent_vote_truncated)
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
modelsummary(list(lm_truncate_vote_change, lm_truncate_vote_share, lm_truncate_emigration_rate),
             title = "DV: Incumbent's Change in Vote Share",
             coef_map = c(schools = "Number of Schools",
                          hospitals = "Number of Hospitals",
                          third_places = "Number of Third Places",
                          emigration_election_year_per_1000 = "Emigration Rate between Election Years per 1000 People",
                          gdp = "GDP"),
             stars = T)
```

Truncated model 1, which focuses on extreme values, shows the most promising results. The school ratio and third places ratio coefficients become more pronounced and have higher statistical significance compared to the models using all observations. The emigration coefficient also becomes statistically significant, which is an improvement compared to the non-truncated models.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=2}
cat("Coefficient Plot for Model 1 (Table 5)")
modelplot(lm_truncate_vote_change,
          coef_map = c(gdp = "GDP",
                       emigration_election_year_per_1000 = "Emigration Rate between\nElection Years per 1000 People",
                       ratio_third_places = "People per Third Places",
                       ratio_hospitals_all_population = "People per Hospital",
                       ratio_schools = "Children per School"))
```